<div>
    <h2>Public Playlists</h2>
    <div class="playlists"></div>
</div>
<div>
    @Html.TextBox("playlistId")
    <button id="RemovePlaylist" onclick="removePlaylist()" class="btn">Remove playlist</button>
    @Html.TextBox("trackId")
    <button id="RemoveTrack" onclick="removeTrack()" class="btn">Remove Track</button>
</div>

@section scripts
{
    <script type="text/javascript" src="../../Scripts/jquery-1.10.2.js"></script>
    <script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.js"></script>

    <script>
        var playlistTemplate = $("#playlistTemplate");
        var trackTemplate = $("#trackTemplate");
        $(document).ready(function() {
            $.ajax({
                cache: false,
                type: "GET",
                url: "/api/playlists",
                dataType: "json",
                async: false,
                success: function(data) {
                    var playlists = data["Result"];
                    for (var i = 0; i < playlists.length; i++) {
                        var playlist = playlists[i];

                        $(".playlists").append(
                            "<h3>" + playlist.Name + "</h3>" +
                            "<table class='tablesorter table table-striped col-md-offset-1'>" +
                            "<thead>" +
                            "<th>Artist</th>" +
                            "<th>Title</th>" +
                            "<th>Album</th>" +
                            "<th>Genre</th>" +
                            "<th>Duration</th>" +
                            "<th>Url</th>" +
                            "</thead>" +
                            "<tbody id='playlist" + playlist.Id + "'></tbody>" +
                            "</table>"
                        );
                        for (var j = 0; j < playlist.Tracks.length; j++) {
                            var track = playlist.Tracks[j];
                            $("#playlist" + playlist.Id).append(
                                "<tr class='removable'>" +
                                "<td>" + track.Artist + "</td>" +
                                "<td>" + track.Name + "</td>" +
                                "<td>" + track.Album + "</td>" +
                                "<td>" + track.Genre + "</td>" +
                                "<td>" + track.Duration + "</td>" +
                                "<td>" + track.Url + "</td>" +
                                "</tr>"
                            );
                        }
                    }
                }
            });
        });

        function removePlaylist() {
            $.ajax({
                cache: false,
                type: "DELETE",
                url: "/api/playlists/delete/" + $('#playlistId').val(),
                dataType: "json",
                async: false,
                success: function (data) {
                    alert("Playlist has been removed");
                }
            });
        }

        function removeTrack() {
            $.ajax({
                cache: false,
                type: "DELETE",
                url: "/api/playlists/delete?trackId=" + $("#trackId").val() + "&playlistId=" + $("#playlistId").val(),
                dataType: "json",
                async: false,
                success: function(data) {
                    alert("Track has been removed");
                }
            });
        }
    </script>
}